<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Molla - Bootstrap eCommerce Template</title>
  <meta name="keywords" content="HTML5 Template">
  <meta name="description" content="Molla - Bootstrap eCommerce Template">
  <meta name="author" content="p-themes">
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/images/icons/favicon-16x16.png">
  <link rel="manifest" href="assets/images/icons/site.html">
  <link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#666666">
  <link rel="shortcut icon" href="assets/images/icons/favicon.ico">
  <meta name="apple-mobile-web-app-title" content="Molla">
  <meta name="application-name" content="Molla">
  <meta name="msapplication-TileColor" content="#cc9966">
  <meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <!-- Plugins CSS File -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <!-- Main CSS File -->
  <link rel="stylesheet" href="assets/css/style.css">
<style>


#progressbar-1 {
color: #455A64;
}

#progressbar-1 li {
list-style-type: none;
font-size: 13px;
width: 33.33%;
float: left;
position: relative;
}

#progressbar-1 #step1:before {
content: "1";
color: #fff;
width: 29px;
margin-left: 50px;
padding-left: 11px;
}

#progressbar-1 #step2:before {
content: "2";
color: #fff;
width: 29px;
}

#progressbar-1 #step3:before {
content: "3";
color: #fff;
width: 29px;
margin-right: 50px;
text-align: center;
}

#progressbar-1 li:before {
line-height: 35px;
display: block;
font-size: 12px;
background: #455A64;
border-radius: 50%;
margin: auto;
}

#progressbar-1 li:after {
content: '';
width: 121%;
height: 8px;
background: #455A64;
position: absolute;
left: 0%;
right: 0%;
top: 15px;
z-index: -1;
}

#progressbar-1 li:nth-child(2):after {
left: 50%

}

#progressbar-1 li:nth-child(1):after {
left: 25%;
width: 121%
}

#progressbar-1 li:nth-child(3):after {
left: 25%;
width: 50%;
}

#progressbar-1 li.active:before,
#progressbar-1 li.active:after {
background: #1266f1;
}

#progressbar-1 li.red1:after,
#progressbar-1 li.red1:before {
background: #f11212;
}



.card-stepper {
z-index: 0
}
</style>
</head>
<body style="background-color: rgb(255, 255, 255);">
  <header class="header">
    <div class="header-middle sticky-header">
        <div class="container">
            <div class="header-left">
                <button class="mobile-menu-toggler">
                    <span class="sr-only">Toggle mobile menu</span>
                    <i class="icon-bars"></i>
                </button>
                <a href="index.html" class="logo">
                    <img src="assets/images/logo.png" alt="Molla Logo" width="105" height="25">
                </a>
                <nav class="main-nav">
                    <ul class="menu sf-arrows">
                        <li class="megamenu-container active">
                            <a href="index.html" class="sf-with-ul">Home</a>
                        </li>
                        <li>
                            <a href="category.html" class="sf-with-ul">Shop</a>
                        </li>
                        <li>
                            <a href="product.html" class="sf-with-ul">Product</a>
                        </li>
                        <li>
                            <a href="#" class="sf-with-ul">Pages</a> 
                        </li>
                        <li>
                            <a href="blog.html" class="sf-with-ul">Blog</a>
                        </li>
                        <li>
                            <a href="elements-list.html" class="sf-with-ul">Elements</a>
                        </li>
                    </ul><!-- End .menu -->
                </nav><!-- End .main-nav -->
            </div><!-- End .header-left -->

            <div class="header-right">
                <div class="header-search">
                    <a href="#" class="search-toggle" role="button" title="Search"><i class="icon-search"></i></a>
                    <form action="#" method="get">
                        <div class="header-search-wrapper">
                            <label for="q" class="sr-only">Search</label>
                            <input type="search" class="form-control" name="q" id="q" placeholder="Search in..." required>
                        </div><!-- End .header-search-wrapper -->
                    </form>
                </div><!-- End .header-search -->
                

                <div class="dropdown cart-dropdown">
                    <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
                        <i class="icon-shopping-cart"></i> 
                    </a>    
            </div><!-- End .header-right -->
        </div><!-- End .container -->
    </div><!-- End .header-middle -->
</header><!-- End .header -->

  <div class="page-header text-center" style="background: #000000;display: flex;height: 100px;align-items: center;">
    <div class="container">
      <h1 class="page-title" style="color: white">Orders</h1>
    </div>
    <!-- End .container -->
  </div>
    <section class="vh-100 gradient-custom-2">
        <div class="container py-5 h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
 

            <% for (let i = 0; i < orderData.length; i++) { %>
              <% const order = orderData[i]; %>
              <% for (let j = 0; j < order.products.length; j++) { %>
                <% const product = order.products[j]; %>
                <div class="col-md-10 col-lg-4 col-xl-9" style="margin-bottom: 20px;">
                  <div class="card card-stepper" style="border-radius: 16px;">
                    <div class="card-body p-4" style="height:fit-content;">
                      <div class="d-flex flex-row mb-4 pb-2">
                        <div class="flex-fill">
                          <h5 class="bold"><%= product.productId.name %></h5>
                          <p class="text-muted">Qt: <%= product.quantity %> item</p>
                          <h4 class="mb-3">â‚¹ <%= product.productId.price %> <span class="small text-muted"> via (<%= order.paymentMethod %>) </span></h4>
                          <p style="font-weight: 600;border: 2px solid;margin-right: 78%;padding: 2%;border-radius: 8px;" class="text-muted">Status : <span class="text-body"><%= product.OrderStatus %></span></p>
                        </div>
                        <div>
                          <img style="border-radius: 8px;" class="align-self-center img-fluid" src="/crop/<%= product.productId.image1 %>" width="150">
                        </div>
                      </div>
                      <ul id="progressbar-1" class="mx-0 mt-0 mb-5 px-0 pt-0 pb-4">
                        <li class="step<%= product.OrderStatus === 'placed' || product.OrderStatus === 'Shipped' || product.OrderStatus === 'Delivered'|| product.OrderStatus === 'Canceled' ? ' active' : '' %>" id="step1">
                            <span style="margin-left: 22px; margin-top: 12px;">ORDER PLACED</span>
                        </li>
                        <li class="step<%= product.OrderStatus === 'Shipped' || product.OrderStatus === 'Delivered'|| product.OrderStatus === 'Canceled' ? ' active' : '' %> text-center" id="step2">
                            <span>PRODUCT SHIPPED</span>
                        </li>
                        

                        <% if (product.OrderStatus === 'Canceled') { %>
                          <li class="step red1 text-muted text-end" id="step3">
                              <span style="margin-right: 22px;">
                                  ORDER CANCELED
                              </span>
                          </li>
                      <% } else if (product.OrderStatus === 'Delivered') { %>
                          <li class="step active text-muted text-end" id="step3">
                              <span style="margin-right: 22px;">
                                  DELIVERED
                              </span>
                          </li>
                      <% }else{ %>
                        <li class="step  text-muted text-end" id="step3">
                            <span style="margin-right: 22px;">
                                DELIVERED
                            </span>
                        </li>
                    <% } %>


                        
                        
                    </ul>
                    </div>
                    <div class="card-footer p-4">
                      <div class="d-flex justify-content-between">
                        <h6 class="fw-normal mb-0">Customer Service: (+91) 7994586558</h6>
                        <div class="border-start h-100"></div>
                        <button id="postButton" data-product-id="<%= product._id %>" data-order-data="<%=orderData[i]._id%>" style="text-decoration: none;font-weight: 500; color: red; background: none; border: none; cursor: pointer;" onclick="handleButtonClick(this)">CANCEL ORDER</button>
                      </div>
                    </div>
                  </div>
                </div>
              <% } %>
            <% } %>
            
          </div>
        </div>
      </section>

     

      <script>
       
       function handleButtonClick(button) {
    const OrderProdID = button.getAttribute('data-product-id');
    const OrderID = button.getAttribute('data-order-data');
    // const orderData = JSON.parse(OrderID);
  const data = {
    orderProdID: OrderProdID,
    OrderID:OrderID,
    
  };

  fetch('/cancelOrder', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      // You may need to include additional headers such as authentication tokens.
    },
    body: JSON.stringify(data),
  })
    .then((response) => response.json())
    .then((data) => {
      location.reload();
    })
    .catch((error) => {
      console.log(error.message);
    });
};
      </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>